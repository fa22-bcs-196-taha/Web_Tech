<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ashfaq Sons - Posts CRUD Manager</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-gold: #D4AF37;
      --primary-red: #C8102E;
      --bg-light: #FDF9F2;
    }
    body { background-color: var(--bg-light); font-family: 'Inter', sans-serif; }
    .card { border: 1px solid #E8DCCA; }
    .btn-gold { background: var(--primary-gold); color: #2C1810; border: none; }
    .btn-gold:hover { background: #B8942F; color: #2C1810; }
    .btn-red { background: var(--primary-red); }
    .btn-red:hover { background: #a50d25; }
    .table th { background: var(--primary-gold); color: #2C1810; }
    .toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 1055; }
    .spinner { width: 1.5rem; height: 1.5rem; }
  </style>
</head>
<body class="py-4">

<div class="container">

  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-dark">Ashfaq Sons CRUD Manager</h1>
    <p class="lead text-muted">Manage Blog Posts with Real-Time API</p>
  </div>

  <!-- Form Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h2 class="h5 mb-3">Add / Update Post</h2>
      <form id="postForm">
        <input type="hidden" id="postId">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" id="title" required>
          </div>
          <div class="col-md-6">
            <label for="userId" class="form-label">User ID</label>
            <input type="number" class="form-control" id="userId" value="1" min="1" required>
          </div>
          <div class="col-12">
            <label for="body" class="form-label">Body</label>
            <textarea class="form-control" id="body" rows="3" required></textarea>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-gold me-2" id="submitBtn">
              <span class="spinner-border spinner-border-sm d-none" role="status"></span>
              Add Post
            </button>
            <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;">Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div id="loading" class="text-center py-5">
    <div class="spinner-border text-gold" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Fetching posts...</p>
  </div>

  <!-- Posts Table -->
  <div class="card shadow-sm" id="postsContainer" style="display:none;">
    <div class="card-body">
      <h2 class="h5 mb-3">All Posts</h2>
      <div class="table-responsive">
        <table class="table table-hover align-middle" id="postsTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Body</th>
              <th>User ID</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Toast Container -->
<div class="toast-container"></div>

<!-- jQuery + Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
  const API_URL = 'https://jsonplaceholder.typicode.com/posts';
  const $form = $('#postForm');
  const $tableBody = $('#postsTable tbody');
  const $loading = $('#loading');
  const $container = $('#postsContainer');
  const $submitBtn = $('#submitBtn');
  const $cancelBtn = $('#cancelBtn');
  const $spinner = $submitBtn.find('.spinner-border');

  // Toast helper
  function showToast(message, type = 'success') {
    const bg = type === 'success' ? 'bg-success' : 'bg-danger';
    const toast = $(`
      <div class="toast align-items-center text-white ${bg} border-0" role="alert">
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    `);
    $('.toast-container').append(toast);
    new bootstrap.Toast(toast[0]).show();
    setTimeout(() => toast.remove(), 5000);
  }

  // Loading state
  function setLoading(loading) {
    $spinner.toggleClass('d-none', !loading);
    $submitBtn.prop('disabled', loading);
  }

  // Reset form
  function resetForm() {
    $form[0].reset();
    $('#postId').val('');
    $submitBtn.text('Add Post');
    $cancelBtn.hide();
  }

  // Render post row
  function renderPost(post) {
    return `
      <tr data-id="${post.id}">
        <td>${post.id}</td>
        <td class="text-truncate" style="max-width:200px;">${post.title}</td>
        <td class="text-truncate" style="max-width:300px;">${post.body}</td>
        <td><span class="badge bg-secondary">${post.userId}</span></td>
        <td class="text-center">
          <button class="btn btn-sm btn-gold edit-btn" title="Edit">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-red delete-btn" title="Delete">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    `;
  }

  // Load all posts
  function loadPosts() {
    $.get(API_URL)
      .done(posts => {
        $loading.hide();
        $container.show();
        $tableBody.empty();
        posts.slice(0, 10).forEach(post => {
          $tableBody.append(renderPost(post));
        });
      })
      .fail(() => {
        $loading.hide();
        showToast('Failed to load posts. Please try again.', 'danger');
      });
  }

  // Create post
  function createPost(data) {
    setLoading(true);
    $.post(API_URL, data)
      .done(newPost => {
        $tableBody.prepend(renderPost(newPost));
        showToast('Post created successfully!');
        resetForm();
      })
      .fail(() => showToast('Failed to create post.', 'danger'))
      .always(() => setLoading(false));
  }

  // Update post
  function updatePost(id, data) {
    setLoading(true);
    $.ajax({
      url: `${API_URL}/${id}`,
      method: 'PUT',
      data: data
    })
      .done(updated => {
        $(`tr[data-id="${id}"]`).replaceWith(renderPost(updated));
        showToast('Post updated successfully!');
        resetForm();
      })
      .fail(() => showToast('Failed to update post.', 'danger'))
      .always(() => setLoading(false));
  }

  // Delete post
  function deletePost(id) {
    if (!confirm('Are you sure you want to delete this post?')) return;

    setLoading(true);
    $.ajax({
      url: `${API_URL}/${id}`,
      method: 'DELETE'
    })
      .done(() => {
        $(`tr[data-id="${id}"]`).remove();
        showToast('Post deleted successfully!');
      })
      .fail(() => showToast('Failed to delete post.', 'danger'))
      .always(() => setLoading(false));
  }

  // Form submit
  $form.on('submit', function(e) {
    e.preventDefault();
    const id = $('#postId').val();
    const data = {
      title: $('#title').val().trim(),
      body: $('#body').val().trim(),
      userId: $('#userId').val()
    };

    if (id) {
      updatePost(id, data);
    } else {
      createPost(data);
    }
  });

  // Edit button
  $tableBody.on('click', '.edit-btn', function() {
    const $row = $(this).closest('tr');
    const id = $row.data('id');
    const title = $row.find('td').eq(1).text();
    const body = $row.find('td').eq(2).text();
    const userId = $row.find('td').eq(3).text();

    $('#postId').val(id);
    $('#title').val(title);
    $('#body').val(body);
    $('#userId').val(userId);
    $submitBtn.text('Update Post');
    $cancelBtn.show();
    $('html, body').animate({ scrollTop: 0 }, 300);
  });

  // Cancel edit
  $cancelBtn.on('click', resetForm);

  // Delete button
  $tableBody.on('click', '.delete-btn', function() {
    const id = $(this).closest('tr').data('id');
    deletePost(id);
  });

  // Initial load
  loadPosts();
});
</script>

</body>
</html>